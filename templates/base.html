<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>{% block title %}Campus Hub{% endblock %}</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}"
    />

    <style>
      /* Smooth transition for theme switching */
      body,
      .navbar,
      .card,
      .form-control,
      .list-group-item {
        transition: background-color 0.3s ease, color 0.3s ease,
          border-color 0.3s ease;
      }

      /* Toggle Button Styles */
      #darkModeToggle {
        border: none;
        background: transparent;
        font-size: 1.2rem;
        padding: 0 10px;
        line-height: 1;
      }
    </style>

    {% block head %}{% endblock %}
  </head>
  <body class="bg-body-tertiary">
    <nav class="navbar navbar-dark bg-dark mb-4">
      <div class="container d-flex justify-content-between align-items-center">
        <a class="navbar-brand" href="{{ url_for('home') }}">üìö Campus Hub</a>

        <div class="d-flex align-items-center">
          <button
            id="darkModeToggle"
            class="btn btn-link text-white text-decoration-none me-3"
            title="Toggle Dark Mode"
          >
            üåô
          </button>

          {% if current_user.is_authenticated %}

          <span class="text-white me-3 d-none d-md-inline"
            >Hello, {{ current_user.username }}</span
          >

          <a
            href="{{ url_for('my_favorites') }}"
            class="btn btn-sm btn-outline-light me-2"
            >‚ù§Ô∏è Favorites</a
          >

          {% if current_user.is_admin %}
          <a
            href="{{ url_for('admin_dashboard') }}"
            class="btn btn-sm btn-outline-warning fw-bold me-2"
            >üõ°Ô∏è Admin</a
          >
          {% endif %}

          <a href="{{ url_for('logout') }}" class="btn btn-sm btn-danger"
            >Logout</a
          >

          {% else %}
          <a
            href="{{ url_for('login') }}"
            class="btn btn-sm btn-outline-light me-2"
            >Login</a
          >
          <a href="{{ url_for('register') }}" class="btn btn-sm btn-light"
            >Register</a
          >
          {% endif %}
        </div>
      </div>
    </nav>

    <div class="container">
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %} {% for category, message in messages %}
      <div
        class="alert alert-{{ category }} alert-dismissible fade show mt-3 shadow-sm"
        role="alert"
      >
        {{ message }}
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
          aria-label="Close"
        ></button>
      </div>
      {% endfor %} {% endif %} {% endwith %} {% block content %} {% endblock %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const htmlElement = document.documentElement;
        const toggleButton = document.getElementById("darkModeToggle");

        // 1. Check Local Storage on Load
        const savedTheme = localStorage.getItem("theme") || "light";
        setTheme(savedTheme);

        // 2. Button Click Event
        toggleButton.addEventListener("click", () => {
          const currentTheme = htmlElement.getAttribute("data-bs-theme");
          const newTheme = currentTheme === "light" ? "dark" : "light";
          setTheme(newTheme);
        });

        // Helper function to apply theme
        function setTheme(theme) {
          htmlElement.setAttribute("data-bs-theme", theme);
          localStorage.setItem("theme", theme);

          // Update Icon
          if (theme === "dark") {
            toggleButton.innerHTML = "‚òÄÔ∏è"; // Sun icon
            toggleButton.classList.add("text-warning");
            toggleButton.classList.remove("text-white");
          } else {
            toggleButton.innerHTML = "üåô"; // Moon icon
            toggleButton.classList.add("text-white");
            toggleButton.classList.remove("text-warning");
          }
        }
      });
    </script>

    {% block scripts %}{% endblock %}
  </body>
</html>
